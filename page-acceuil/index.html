<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Acceuil</title>

    <link rel="stylesheet" href="acceuil.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <h1 class="fw-bold text-center">Gestionnaire de notes étudiants </h1>

    <!-- les Cards -->

    <div class="container">
        <div class="row d-flex justify-content-between">
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card shadow-lg" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title text-center fw-bold">Nombres d'etudiant</h5>
                    </div>
                    <p class="text-center h1 fw-bold " id="nbr-etudiant">0</p>
                </div>
            </div>

            <!-- _________________________________________________________________________________ -->


            <div class="col-12 col-md-6 col-lg-3">
                <div class="card shadow-lg" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title text-center fw-bold">Sommes des notes</h5>
                    </div>
                    <p class="text-center h1 fw-bold " id="sommes-des-notes">0</p>
                </div>
            </div>

            <!-- __________________________________________________________________________________________ -->


            <div class="col-12 col-md-6 col-lg-3">
                <div class="card shadow-lg" style="width: 18rem;">
                    <div class="card-body">
                        <h5 class="card-title text-center fw-bold"> Moyenne plus grande</h5>
                    </div>
                    <p class="text-center h1 fw-bold " id="Moyenne-plus-grand">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ___________________________________________________________________________________________ -->

    <!-- Pertie recherche  et ajouter-->

    <div class="container  my-3 ">
        <div class="row  d-flex justify-content-between  ">
            <div class="col-md-6 ">
                <form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                </form>
            </div>

            <div class="col-md-6  ">

                <div class="col float-end d-flex align-items-center">
                    <!-- <h1 class="my-5 text-center">Bonjour</h1> -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        Cliquer pour ajouter les etudiants
                    </button>


                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Ajouter ou modifier les
                                        étudiants</h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <label for="prenom" class="me-5">Prenom</label>
                                    <input type="text" id="prenom" required> <br> <br>
                                    <label for="nom" class="me-5">Nom </label>
                                    <input type="text" id="nom" required> <br> <br>

                                    <label for="note" class="me-5">Note</label>
                                    <input type="number" id="note" required min="0" max="20"> <br> <br>

                                    <label for="moyenne" class="me-5">Moyenne </label>
                                    <input type="number" id="moyenne" required min="0" max="20"> <br> <br>

                                    <button class="btn btn-primary" id="add">Ajouter étudiant</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Modal pour la modification -->
            <div id="modalModif" class="modal fade" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalLabel">Modifier l'Étudiant</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="formModif">
                                <div class="mb-3">
                                    <label for="prenom2" class="form-label">Prénom</label>
                                    <input type="text" class="form-control" id="prenom2">
                                </div>
                                <div class="mb-3">
                                    <label for="nom2" class="form-label">Nom</label>
                                    <input type="text" class="form-control" id="nom2">
                                </div>
                                <div class="mb-3">
                                    <label for="note2" class="form-label">Note</label>
                                    <input type="number" class="form-control" id="note2" step="0.1">
                                </div>
                                <div class="mb-3">
                                    <label for="moyenne2" class="form-label">Moyenne</label>
                                    <input type="number" class="form-control" id="moyenne2" step="0.1">
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" id="saveChanges">Enregistrer</button>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>



    <!-- ___________________________________________________________________________________________ -->

    <!-- Tableau-->

    <div class="container my-5">
        <div class="row">
            <div class="col">
                <table class="table">
                    <thead class=" ">
                        <tr>
                            <th scope="col">Prenoms</th>
                            <th scope="col">Noms</th>
                            <th scope="col">Notes</th>
                            <th scope="col">Moyennes</th>
                            <th scope="col">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableauBody">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, deleteField, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyCK_dwYMhpZ-yPUY2Cdubn4z-uPlce_UlE",
            authDomain: "gestionnaire-de-note-en-groupe.firebaseapp.com",
            projectId: "gestionnaire-de-note-en-groupe",
            storageBucket: "gestionnaire-de-note-en-groupe.appspot.com",
            messagingSenderId: "701912210994",
            appId: "1:701912210994:web:03b619719e4c137035e62b",
            measurementId: "G-PZDTV2RNCF"
        };
    
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
    
        // Ajouter un étudiant
        document.getElementById("add").addEventListener('click', async (e) => {
            e.preventDefault();
            let prenom = document.getElementById("prenom").value;
            let nom = document.getElementById("nom").value;
            let note = document.getElementById("note").value;
            let moyenne = document.getElementById("moyenne").value;
    
            try {
                const docRef = await addDoc(collection(db, "etudiants"), {
                    Prenom: prenom,
                    Nom: nom,
                    Note: note,
                    Moyenne: moyenne
                });
                console.log("Document written with ID: ", docRef.id);
                document.getElementById("prenom").value = '';
                document.getElementById("nom").value = '';
                document.getElementById("note").value = '';
                document.getElementById("moyenne").value = '';
                loadStudents();
            } catch (e) {
                console.error("Error adding document: ", e);
            }
        });
    
        // Charger les étudiants
        async function loadStudents() {
            const tableauBody = document.getElementById("tableauBody");
            tableauBody.innerHTML = '';
    
            try {
                const querySnapshot = await getDocs(collection(db, "etudiants"));
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${data.Prenom}</td>
                        <td>${data.Nom}</td>
                        <td>${data.Note}</td>
                        <td>${data.Moyenne}</td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="voirStudent('${doc.id}')"><i class="bi bi-eye-fill"></i></button>
                            <button class="btn btn-primary btn-sm" onclick="editStudent('${doc.id}', '${data.Prenom}', '${data.Nom}', ${data.Note}, ${data.Moyenne})"><i class="bi bi-pencil-square"></i></button>
                            <button class="btn btn-danger btn-sm" onclick="deleteStudent('${doc.id}')"><i class="bi bi-trash3"></i></button>

                        </td>
                    `;
                    tableauBody.appendChild(row);
                });
            } catch (e) {
                console.error("Error loading documents: ", e);
            }
        }

        window.editStudent = (id, prenom, nom, note, moyenne) => {
            document.getElementById("prenom2").value = prenom;
            document.getElementById("nom2").value = nom;
            document.getElementById("note2").value = note;
            document.getElementById("moyenne2").value = moyenne;
            document.getElementById("saveChanges").onclick = () => saveChanges(id);
            new bootstrap.Modal(document.getElementById('modalModif')).show();
        };
    
        async function saveChanges(id) {
            const prenom = document.getElementById("prenom2").value;
            const nom = document.getElementById("nom2").value;
            const note = document.getElementById("note2").value;
            const moyenne = document.getElementById("moyenne2").value;
    
            try {
                const studentRef = doc(db, "etudiants", id);
                await updateDoc(studentRef, {
                    Prenom: prenom,
                    Nom: nom,
                    Note: note,
                    Moyenne: moyenne
                });
                console.log("Document successfully updated.");
                new bootstrap.Modal(document.getElementById('modalModif')).hide();
                loadStudents();
            } catch (e) {
                console.error("Error updating document: ", e);
            }
        }
    
        window.deleteStudent = async (id) => {
            try {
                await deleteDoc(doc(db, "etudiants", id));
                console.log("Document successfully deleted.");
                loadStudents(); 
            } catch (e) {
                console.error("Error deleting document: ", e);
            }
        };

        // Charger les étudiants au chargement de la page
        loadStudents();
    
    </script>
    
    <script src="acceuil.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>